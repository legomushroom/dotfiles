export RUST_BACKTRACE=1

# Colours
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
LIGHT_BLUE="\033[1;34m"
CYAN="\033[1;36m"
NO_COLOR='\033[0m'

# Git
git config --global user.name "Oleg Solomka"
git config --global user.email "legomushroom@gmail.com"
git config --global push.autoSetupRemote true
git config --global push.default current

alias ku="kubectl"

# Bash
alias cfg="code ~/.bashrc-utils"
alias fresh="source ~/.bashrc"

# Rust
alias irust="curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y"
alias cb="cargo build"
alias ce="cargo run --example"

# Run a command N times.
#
# ## Examples
# 
# Echoes "1" 5 times:
# ```shell
#   runx 5 echo "1"
# ```
#
function runx() {
  for ((i = 0; i < $1; i++)) {
    # echo "\n-- runx: $i\n";
    ${*:2}; 
  }
}

# Same as `runx` but exits if command run yields unsuccessful exit code
#
# ## Examples
# 
# Runs `cargo t -- dns_map::tests::resolve::removes_expired_records_while_adds` command
# 5 times and exits on first unsuccessful result:
# ```shell
#   testx 5 cargo t -- dns_map::tests::resolve::removes_expired_records_while_adds
# ```
#
function testx() {
  echo -e "\n ðŸ $1 times\n";
  for ((i = 1; i <= $1; i++)) {
    echo -e " ðŸƒ $i \n";
    # execute command on current iteration
    ${*:2};
    TESTX_EXIT_CODE=$?;
    # if the current execution was unsuccessful,
    # exit with the same exit code
    if [[ $TESTX_EXIT_CODE != 0 ]]; then
      echo -e "\n ðŸ’£ $i \n";
      return $TESTX_EXIT_CODE;
    fi
  }

  echo -e "âœ… all $1 done";
}

# Kill process by name.
#
# ## Examples
# 
# Kills `gh-net` process:
# ```shell
#   kproc gh-net
# ```
#
function kproc() {
  if [ -z $1 ]; then
    echo -e "\nðŸš§ please provide process name, e.g. ${YELLOW}'kproc gh-net'${NO_COLOR}\n";
    return 1;
  fi

  ps -ef | grep $1 | grep -v grep | awk '{print $2}' | sudo xargs -r kill -9;
}
